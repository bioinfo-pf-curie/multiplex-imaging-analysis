/*
 * Define modules options
 */


process {

  // Default
  //publishDir = [
  //  path: { "${params.outDir}/${task.process.tokenize(':')[-1].tokenize('_')[0]}" },
  //  mode: 'copy',
  //  saveAs: { filename -> filename.equals('versions.txt') ? null : filename }
  //]

  withName:'splitImage' {
     ext.args = params.segmentation.overlap ? " --overlap $params.segmentation.overlap" : ""
     ext.args += params.segmentation.tileHeight ? " --height $params.segmentation.tileHeight" : ""
  }

  withName:'pyramidize' {
    publishDir = [
      path: { "${params.outDir}/${tag}/" },
      mode: 'copy',
    ]
  }

  withName:'computeMasks' {
    publishDir = [
      path: { "${params.outDir}/masks/" },
      mode: 'copy',
      pattern: "*_masks.ti{f,ff}"
    ]

    ext.args = params.masks.overlap != null ? " --overlap $params.masks.overlap" : ""
  }

  withName:'stitch' {
    publishDir = [
      path: { "${params.outDir}/masks/" },
      mode: 'copy',
      pattern: "*_masks.ti{f,ff}"
    ]
    ext.args = params.segmentation.overlap ? " --overlap $params.segmentation.overlap" : ""
  }

  withName:'quantification' {
    publishDir = [
      path: { "${params.outDir}/quantification/" },
      mode: 'copy',
      pattern: "*.csv",
      saveAs: { filename -> "${meta.originalName}_data.csv" }
    ]
  }

  withName:'getSoftwareVersions' {
    publishDir = [
      path: { "${params.outDir}/softwareVersions" },
      mode: 'copy'
    ]
  }

  withName:'outputDocumentation' {
    publishDir = [
      path: { "${params.summaryDir}" },
      mode: 'copy'
    ]
  }

  withName:'mergeChannels' {
    ext.args = params.normalization.mode ? "--norm $params.normalization.mode" : "" 
  }

  withName:'segmentation' {
    ext.args = params.segmentation.additionalParms ? "$params.segmentation.additionalParms" : "" 
  }


}